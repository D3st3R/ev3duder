\hypertarget{tcp_8h}{}\section{src/tcp.h File Reference}
\label{tcp_8h}\index{src/tcp.\+h@{src/tcp.\+h}}


B\+S\+D sockets/\+Winsock2 Input/\+Output wrappers.  


{\ttfamily \#include \char`\"{}defs.\+h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structtcp__handle}{tcp\+\_\+handle}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{tcp_8h_a73bbacb33eb7b06833dabe1539b6e4bd}{tcp\+\_\+open} (const char $\ast$\hyperlink{main_8c_a32890a020a4d7c2d5ea73721807010c4}{serial}, unsigned \hyperlink{main_8c_a7bd15b1b4bbdd7329986c9c4af33d10d}{timeout})
\begin{DoxyCompactList}\small\item\em open a bluetooth device described by device. {\ttfamily N\+U\+L\+L} leads to default action \end{DoxyCompactList}\item 
void \hyperlink{tcp_8h_ac044dee22af45e1e334657df6ca09d56}{tcp\+\_\+close} (void $\ast$)
\begin{DoxyCompactList}\small\item\em Closes the resource opened by {\ttfamily bt\+\_\+open}. \end{DoxyCompactList}\item 
const wchar\+\_\+t $\ast$ \hyperlink{tcp_8h_a3893ee96ae73bdde565a655a8921ae9c}{tcp\+\_\+error} (void $\ast$device)
\begin{DoxyCompactList}\small\item\em Returns an error string describing the last error occured. \end{DoxyCompactList}\item 
const wchar\+\_\+t $\ast$ \hyperlink{tcp_8h_a0e21a1192bde43115c3763f02c51765b}{tcp\+\_\+info} (void $\ast$device)
\begin{DoxyCompactList}\small\item\em Returns an error string describing the last error occured. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int($\ast$ \hyperlink{tcp_8h_a5f7000a76dbf208a176f1b3b5ea9cebc}{tcp\+\_\+write} )(void $\ast$device, const \hyperlink{defs_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8} $\ast$buf, size\+\_\+t count)
\begin{DoxyCompactList}\small\item\em writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device \end{DoxyCompactList}\item 
int($\ast$ \hyperlink{tcp_8h_a82118920bf919568655ec9b421f5d04e}{tcp\+\_\+read} )(void $\ast$device, \hyperlink{defs_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8} $\ast$buf, size\+\_\+t count, int milliseconds)
\begin{DoxyCompactList}\small\item\em writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
B\+S\+D sockets/\+Winsock2 Input/\+Output wrappers. 

\begin{DoxyAuthor}{Author}
Ahmad Fatoum 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
(c) 2015 Ahmad Fatoum. Code available under terms of the G\+N\+U General Public License 3.\+0 
\end{DoxyCopyright}


\subsection{Function Documentation}
\hypertarget{tcp_8h_ac044dee22af45e1e334657df6ca09d56}{}\index{tcp.\+h@{tcp.\+h}!tcp\+\_\+close@{tcp\+\_\+close}}
\index{tcp\+\_\+close@{tcp\+\_\+close}!tcp.\+h@{tcp.\+h}}
\subsubsection[{tcp\+\_\+close(void $\ast$)}]{\setlength{\rightskip}{0pt plus 5cm}void tcp\+\_\+close (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{sock}
\end{DoxyParamCaption}
)}\label{tcp_8h_ac044dee22af45e1e334657df6ca09d56}


Closes the resource opened by {\ttfamily bt\+\_\+open}. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See also}
implementation at \hyperlink{bt-win_8c}{bt-\/win.\+c} and \hyperlink{bt-unix_8c}{bt-\/unix.\+c}
\end{DoxySeeAlso}
Closes the resource opened by {\ttfamily bt\+\_\+open}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by \hyperlink{tcp_8h_a73bbacb33eb7b06833dabe1539b6e4bd}{tcp\+\_\+open()} \\
\hline
\end{DoxyParams}


Definition at line 241 of file tcp.\+c.

\hypertarget{tcp_8h_a3893ee96ae73bdde565a655a8921ae9c}{}\index{tcp.\+h@{tcp.\+h}!tcp\+\_\+error@{tcp\+\_\+error}}
\index{tcp\+\_\+error@{tcp\+\_\+error}!tcp.\+h@{tcp.\+h}}
\subsubsection[{tcp\+\_\+error(void $\ast$device)}]{\setlength{\rightskip}{0pt plus 5cm}const wchar\+\_\+t$\ast$ tcp\+\_\+error (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fd\+\_\+}
\end{DoxyParamCaption}
)}\label{tcp_8h_a3893ee96ae73bdde565a655a8921ae9c}


Returns an error string describing the last error occured. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
message An error string 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
implementation at \hyperlink{bt-win_8c}{bt-\/win.\+c} and \hyperlink{bt-unix_8c}{bt-\/unix.\+c} 
\end{DoxySeeAlso}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000016}{Bug}]it\textquotesingle{}s useless \end{DoxyRefDesc}



\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by \hyperlink{tcp_8c_a73bbacb33eb7b06833dabe1539b6e4bd}{tcp\+\_\+open()} \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
message An error string 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000013}{Bug}]it\textquotesingle{}s useless. Could use {\ttfamily wprintf} and {\ttfamily strerror} \end{DoxyRefDesc}


Definition at line 256 of file tcp.\+c.

\hypertarget{tcp_8h_a0e21a1192bde43115c3763f02c51765b}{}\index{tcp.\+h@{tcp.\+h}!tcp\+\_\+info@{tcp\+\_\+info}}
\index{tcp\+\_\+info@{tcp\+\_\+info}!tcp.\+h@{tcp.\+h}}
\subsubsection[{tcp\+\_\+info(void $\ast$device)}]{\setlength{\rightskip}{0pt plus 5cm}const wchar\+\_\+t$\ast$ tcp\+\_\+info (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{device}
\end{DoxyParamCaption}
)}\label{tcp_8h_a0e21a1192bde43115c3763f02c51765b}


Returns an error string describing the last error occured. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
message An error string 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
implementation at \hyperlink{bt-win_8c}{bt-\/win.\+c} and \hyperlink{bt-unix_8c}{bt-\/unix.\+c} 
\end{DoxySeeAlso}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000017}{Bug}]it\textquotesingle{}s useless \end{DoxyRefDesc}
\hypertarget{tcp_8h_a73bbacb33eb7b06833dabe1539b6e4bd}{}\index{tcp.\+h@{tcp.\+h}!tcp\+\_\+open@{tcp\+\_\+open}}
\index{tcp\+\_\+open@{tcp\+\_\+open}!tcp.\+h@{tcp.\+h}}
\subsubsection[{tcp\+\_\+open(const char $\ast$serial, unsigned timeout)}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ tcp\+\_\+open (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{serial, }
\item[{unsigned}]{timeout}
\end{DoxyParamCaption}
)}\label{tcp_8h_a73bbacb33eb7b06833dabe1539b6e4bd}


open a bluetooth device described by device. {\ttfamily N\+U\+L\+L} leads to default action 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em serial} & of Ev3 to connect to \\
\hline
\mbox{\tt in}  & {\em timeout} & for U\+D\+P recv \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
handle a opaque handle for use with tcp\+\_\+\{read,write,close,error\} 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
implementation at \hyperlink{bt-win_8c}{bt-\/win.\+c} and \hyperlink{bt-unix_8c}{bt-\/unix.\+c}
\end{DoxySeeAlso}
open a bluetooth device described by device. {\ttfamily N\+U\+L\+L} leads to default action


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em serial} & I\+P-\/\+Address or Serial-\/\+Number of Ev3. {\ttfamily N\+U\+L\+L} connects to the first available \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\&fd pointer to file descriptor for use with tcp\+\_\+\{read,write,close,error\} If the serial number contains a dot, a direct T\+C\+P connection is attempted. The Ev3 broadcasts a U\+D\+P-\/packet every 5 seconds. This functions waits 7 seconds for that to happen. It then compares the broadcasted serial number with the value set should serial be non-\/{\ttfamily N\+U\+L\+L}. If serial is {\ttfamily N\+U\+L\+L} or the serial numbers match, a udp packet is sent to the source port on the ev3. Afterwards the Ev3 starts listening on the port it broadcasted. Then a G\+E\+T request is sent and the V\+M starts listening and business is as usual 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{http://www.monobrick.dk/guides/how-to-establish-a-wifi-connection-with-the-ev3-brick/}{\tt http\+://www.\+monobrick.\+dk/guides/how-\/to-\/establish-\/a-\/wifi-\/connection-\/with-\/the-\/ev3-\/brick/} 
\end{DoxySeeAlso}


Definition at line 84 of file tcp.\+c.



\subsection{Variable Documentation}
\hypertarget{tcp_8h_a82118920bf919568655ec9b421f5d04e}{}\index{tcp.\+h@{tcp.\+h}!tcp\+\_\+read@{tcp\+\_\+read}}
\index{tcp\+\_\+read@{tcp\+\_\+read}!tcp.\+h@{tcp.\+h}}
\subsubsection[{tcp\+\_\+read}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ tcp\+\_\+read) (void $\ast$device, {\bf u8} $\ast$buf, size\+\_\+t count, int milliseconds)}\label{tcp_8h_a82118920bf919568655ec9b421f5d04e}


writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\mbox{\tt in}  & {\em buf} & buffer to write to \\
\hline
\mbox{\tt in}  & {\em count} & number of characters to be read \\
\hline
\mbox{\tt in}  & {\em milliseconds} & number of milliseconds to wait at maximum. -\/1 is indefinitely \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
status -\/1 on error. bytes read otherwise. 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000015}{Bug}]the milliseconds part needs to be tested more throughly \begin{DoxySeeAlso}{See also}
implementation at \hyperlink{bt-win_8c}{bt-\/win.\+c} and \hyperlink{bt-unix_8c}{bt-\/unix.\+c} 
\end{DoxySeeAlso}
\end{DoxyRefDesc}


Definition at line 272 of file tcp.\+c.

\hypertarget{tcp_8h_a5f7000a76dbf208a176f1b3b5ea9cebc}{}\index{tcp.\+h@{tcp.\+h}!tcp\+\_\+write@{tcp\+\_\+write}}
\index{tcp\+\_\+write@{tcp\+\_\+write}!tcp.\+h@{tcp.\+h}}
\subsubsection[{tcp\+\_\+write}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ tcp\+\_\+write) (void $\ast$device, const {\bf u8} $\ast$buf, size\+\_\+t count)}\label{tcp_8h_a5f7000a76dbf208a176f1b3b5ea9cebc}


writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\mbox{\tt in}  & {\em buf} & byte string to write, the first byte is omitted \\
\hline
\mbox{\tt in}  & {\em count} & number of characters to be written (including leading ignored byte) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
status -\/1 on error. bytes read otherwise. 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000014}{Bug}]the first byte is omitted for compatiblity with the leading report byte demanded by {\ttfamily hid\+\_\+write}. Wrapping H\+I\+D\+A\+P\+I could fix this. \begin{DoxySeeAlso}{See also}
implementation at \hyperlink{bt-win_8c}{bt-\/win.\+c} and \hyperlink{bt-unix_8c}{bt-\/unix.\+c} 
\end{DoxySeeAlso}
\end{DoxyRefDesc}


Definition at line 271 of file tcp.\+c.

