\hypertarget{tcp_8c}{}\section{src/tcp.c File Reference}
\label{tcp_8c}\index{src/tcp.\+c@{src/tcp.\+c}}
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$sys/socket.\+h$>$}\\*
{\ttfamily \#include $<$netinet/in.\+h$>$}\\*
{\ttfamily \#include $<$arpa/inet.\+h$>$}\\*
{\ttfamily \#include $<$sys/time.\+h$>$}\\*
{\ttfamily \#include $<$netdb.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include \char`\"{}btserial.\+h\char`\"{}}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include \char`\"{}defs.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tcp.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tcp_8c_a26769957ec1a2beaf223f33b66ee64ab}{I\+N\+V\+A\+L\+I\+D\+\_\+\+S\+O\+C\+K\+E\+T}~(-\/1)
\item 
\#define \hyperlink{tcp_8c_a633b0396ff93d336a088412a190a5072}{S\+O\+C\+K\+E\+T\+\_\+\+E\+R\+R\+O\+R}~(-\/1)
\item 
\#define \hyperlink{tcp_8c_a0a138470b56ab4c559f4690342cc2ab3}{bailout}(msg)~perror((msg))
\item 
\#define \hyperlink{tcp_8c_afdbb9d84bd17efd2ae7290e664992c48}{closesocket}~close
\item 
\#define \hyperlink{tcp_8c_a2b3cd5ebb2cdbd725b5ca5f2d7b57460}{socksetblock}(sock,  y\+\_\+n)
\item 
\#define \hyperlink{tcp_8c_a7342deb9bd9ebf195e550e2d8e7c38b4}{U\+D\+P\+\_\+\+P\+O\+R\+T}~3015
\begin{DoxyCompactList}\small\item\em default U\+D\+P broadcast port \end{DoxyCompactList}\item 
\#define \hyperlink{tcp_8c_a637b73f06ee87043251d022f87a8f3d4}{T\+C\+P\+\_\+\+P\+O\+R\+T}~5555
\item 
\#define \hyperlink{tcp_8c_ac14dc16fce09fbf3428de5b39d1bcd17}{U\+D\+P\+\_\+\+R\+E\+C\+V\+\_\+\+T\+I\+M\+E\+O\+U\+T}~6
\item 
\#define \hyperlink{tcp_8c_ab89edd66c8efe44885d367f9ca958cbc}{T\+C\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T}~1
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef int \hyperlink{tcp_8c_a8dc8083897335125630f1af5dafd5831}{S\+O\+C\+K\+E\+T}
\begin{DoxyCompactList}\small\item\em B\+S\+D Sockets/\+Winsock2 I/\+O wrappers. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{tcp_8c_a73bbacb33eb7b06833dabe1539b6e4bd}{tcp\+\_\+open} (const char $\ast$\hyperlink{main_8c_a32890a020a4d7c2d5ea73721807010c4}{serial}, unsigned \hyperlink{main_8c_a7bd15b1b4bbdd7329986c9c4af33d10d}{timeout})
\begin{DoxyCompactList}\small\item\em connects to a ev3 device on the same subnet. \end{DoxyCompactList}\item 
void \hyperlink{tcp_8c_a98592c2f9a6754ad849ce9767f1b6777}{tcp\+\_\+close} (void $\ast$sock)
\begin{DoxyCompactList}\small\item\em releases the socket file descriptor opened by \hyperlink{tcp_8c_a73bbacb33eb7b06833dabe1539b6e4bd}{tcp\+\_\+open()} \end{DoxyCompactList}\item 
const wchar\+\_\+t $\ast$ \hyperlink{tcp_8c_acb5191eb921dee0820de3cb6da0ec8e1}{tcp\+\_\+error} (void $\ast$fd\+\_\+)
\begin{DoxyCompactList}\small\item\em Returns an error string describing the last error occured. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int($\ast$ \hyperlink{tcp_8c_a5f7000a76dbf208a176f1b3b5ea9cebc}{tcp\+\_\+write} )(void $\ast$device, const \hyperlink{defs_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8} $\ast$buf, size\+\_\+t count) = \hyperlink{btserial_8h_ac9b25cd932b8c5a842d1cd96e22fd200}{bt\+\_\+write}
\begin{DoxyCompactList}\small\item\em writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device \end{DoxyCompactList}\item 
int($\ast$ \hyperlink{tcp_8c_a82118920bf919568655ec9b421f5d04e}{tcp\+\_\+read} )(void $\ast$device, \hyperlink{defs_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8} $\ast$buf, size\+\_\+t count, int milliseconds) = \hyperlink{btserial_8h_a1b964cfcb627fd4cda8298d8f2d9f0d3}{bt\+\_\+read}
\begin{DoxyCompactList}\small\item\em writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{tcp_8c_a0a138470b56ab4c559f4690342cc2ab3}{}\index{tcp.\+c@{tcp.\+c}!bailout@{bailout}}
\index{bailout@{bailout}!tcp.\+c@{tcp.\+c}}
\subsubsection[{bailout}]{\setlength{\rightskip}{0pt plus 5cm}\#define bailout(
\begin{DoxyParamCaption}
\item[{}]{msg}
\end{DoxyParamCaption}
)~perror((msg))}\label{tcp_8c_a0a138470b56ab4c559f4690342cc2ab3}


Definition at line 38 of file tcp.\+c.

\hypertarget{tcp_8c_afdbb9d84bd17efd2ae7290e664992c48}{}\index{tcp.\+c@{tcp.\+c}!closesocket@{closesocket}}
\index{closesocket@{closesocket}!tcp.\+c@{tcp.\+c}}
\subsubsection[{closesocket}]{\setlength{\rightskip}{0pt plus 5cm}\#define closesocket~close}\label{tcp_8c_afdbb9d84bd17efd2ae7290e664992c48}


Definition at line 39 of file tcp.\+c.

\hypertarget{tcp_8c_a26769957ec1a2beaf223f33b66ee64ab}{}\index{tcp.\+c@{tcp.\+c}!I\+N\+V\+A\+L\+I\+D\+\_\+\+S\+O\+C\+K\+E\+T@{I\+N\+V\+A\+L\+I\+D\+\_\+\+S\+O\+C\+K\+E\+T}}
\index{I\+N\+V\+A\+L\+I\+D\+\_\+\+S\+O\+C\+K\+E\+T@{I\+N\+V\+A\+L\+I\+D\+\_\+\+S\+O\+C\+K\+E\+T}!tcp.\+c@{tcp.\+c}}
\subsubsection[{I\+N\+V\+A\+L\+I\+D\+\_\+\+S\+O\+C\+K\+E\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define I\+N\+V\+A\+L\+I\+D\+\_\+\+S\+O\+C\+K\+E\+T~(-\/1)}\label{tcp_8c_a26769957ec1a2beaf223f33b66ee64ab}


Definition at line 36 of file tcp.\+c.

\hypertarget{tcp_8c_a633b0396ff93d336a088412a190a5072}{}\index{tcp.\+c@{tcp.\+c}!S\+O\+C\+K\+E\+T\+\_\+\+E\+R\+R\+O\+R@{S\+O\+C\+K\+E\+T\+\_\+\+E\+R\+R\+O\+R}}
\index{S\+O\+C\+K\+E\+T\+\_\+\+E\+R\+R\+O\+R@{S\+O\+C\+K\+E\+T\+\_\+\+E\+R\+R\+O\+R}!tcp.\+c@{tcp.\+c}}
\subsubsection[{S\+O\+C\+K\+E\+T\+\_\+\+E\+R\+R\+O\+R}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+O\+C\+K\+E\+T\+\_\+\+E\+R\+R\+O\+R~(-\/1)}\label{tcp_8c_a633b0396ff93d336a088412a190a5072}


Definition at line 37 of file tcp.\+c.

\hypertarget{tcp_8c_a2b3cd5ebb2cdbd725b5ca5f2d7b57460}{}\index{tcp.\+c@{tcp.\+c}!socksetblock@{socksetblock}}
\index{socksetblock@{socksetblock}!tcp.\+c@{tcp.\+c}}
\subsubsection[{socksetblock}]{\setlength{\rightskip}{0pt plus 5cm}\#define socksetblock(
\begin{DoxyParamCaption}
\item[{}]{sock, }
\item[{}]{y\+\_\+n}
\end{DoxyParamCaption}
)}\label{tcp_8c_a2b3cd5ebb2cdbd725b5ca5f2d7b57460}
{\bfseries Value\+:}
\begin{DoxyCode}
((y\_n) ? \(\backslash\)
    fcntl((sock), F\_SETFL, fcntl((sock), F\_GETFL, 0) & ~O\_NONBLOCK) : \(\backslash\)
    fcntl((sock), F\_SETFL, O\_NONBLOCK))
\end{DoxyCode}


Definition at line 40 of file tcp.\+c.

\hypertarget{tcp_8c_ab89edd66c8efe44885d367f9ca958cbc}{}\index{tcp.\+c@{tcp.\+c}!T\+C\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T@{T\+C\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{T\+C\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T@{T\+C\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T}!tcp.\+c@{tcp.\+c}}
\subsubsection[{T\+C\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+C\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T~1}\label{tcp_8c_ab89edd66c8efe44885d367f9ca958cbc}


Definition at line 68 of file tcp.\+c.

\hypertarget{tcp_8c_a637b73f06ee87043251d022f87a8f3d4}{}\index{tcp.\+c@{tcp.\+c}!T\+C\+P\+\_\+\+P\+O\+R\+T@{T\+C\+P\+\_\+\+P\+O\+R\+T}}
\index{T\+C\+P\+\_\+\+P\+O\+R\+T@{T\+C\+P\+\_\+\+P\+O\+R\+T}!tcp.\+c@{tcp.\+c}}
\subsubsection[{T\+C\+P\+\_\+\+P\+O\+R\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+C\+P\+\_\+\+P\+O\+R\+T~5555}\label{tcp_8c_a637b73f06ee87043251d022f87a8f3d4}


Definition at line 65 of file tcp.\+c.

\hypertarget{tcp_8c_a7342deb9bd9ebf195e550e2d8e7c38b4}{}\index{tcp.\+c@{tcp.\+c}!U\+D\+P\+\_\+\+P\+O\+R\+T@{U\+D\+P\+\_\+\+P\+O\+R\+T}}
\index{U\+D\+P\+\_\+\+P\+O\+R\+T@{U\+D\+P\+\_\+\+P\+O\+R\+T}!tcp.\+c@{tcp.\+c}}
\subsubsection[{U\+D\+P\+\_\+\+P\+O\+R\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define U\+D\+P\+\_\+\+P\+O\+R\+T~3015}\label{tcp_8c_a7342deb9bd9ebf195e550e2d8e7c38b4}


default U\+D\+P broadcast port 



Definition at line 64 of file tcp.\+c.

\hypertarget{tcp_8c_ac14dc16fce09fbf3428de5b39d1bcd17}{}\index{tcp.\+c@{tcp.\+c}!U\+D\+P\+\_\+\+R\+E\+C\+V\+\_\+\+T\+I\+M\+E\+O\+U\+T@{U\+D\+P\+\_\+\+R\+E\+C\+V\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{U\+D\+P\+\_\+\+R\+E\+C\+V\+\_\+\+T\+I\+M\+E\+O\+U\+T@{U\+D\+P\+\_\+\+R\+E\+C\+V\+\_\+\+T\+I\+M\+E\+O\+U\+T}!tcp.\+c@{tcp.\+c}}
\subsubsection[{U\+D\+P\+\_\+\+R\+E\+C\+V\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define U\+D\+P\+\_\+\+R\+E\+C\+V\+\_\+\+T\+I\+M\+E\+O\+U\+T~6}\label{tcp_8c_ac14dc16fce09fbf3428de5b39d1bcd17}


Definition at line 67 of file tcp.\+c.



\subsection{Typedef Documentation}
\hypertarget{tcp_8c_a8dc8083897335125630f1af5dafd5831}{}\index{tcp.\+c@{tcp.\+c}!S\+O\+C\+K\+E\+T@{S\+O\+C\+K\+E\+T}}
\index{S\+O\+C\+K\+E\+T@{S\+O\+C\+K\+E\+T}!tcp.\+c@{tcp.\+c}}
\subsubsection[{S\+O\+C\+K\+E\+T}]{\setlength{\rightskip}{0pt plus 5cm}typedef int {\bf S\+O\+C\+K\+E\+T}}\label{tcp_8c_a8dc8083897335125630f1af5dafd5831}


B\+S\+D Sockets/\+Winsock2 I/\+O wrappers. 

\begin{DoxyAuthor}{Author}
Ahmad Fatoum 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
(c) 2015 Ahmad Fatoum. Code available under terms of the G\+N\+U General Public License 3.\+0 
\end{DoxyCopyright}


Definition at line 35 of file tcp.\+c.



\subsection{Function Documentation}
\hypertarget{tcp_8c_a98592c2f9a6754ad849ce9767f1b6777}{}\index{tcp.\+c@{tcp.\+c}!tcp\+\_\+close@{tcp\+\_\+close}}
\index{tcp\+\_\+close@{tcp\+\_\+close}!tcp.\+c@{tcp.\+c}}
\subsubsection[{tcp\+\_\+close(void $\ast$sock)}]{\setlength{\rightskip}{0pt plus 5cm}void tcp\+\_\+close (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{sock}
\end{DoxyParamCaption}
)}\label{tcp_8c_a98592c2f9a6754ad849ce9767f1b6777}


releases the socket file descriptor opened by \hyperlink{tcp_8c_a73bbacb33eb7b06833dabe1539b6e4bd}{tcp\+\_\+open()} 

Closes the resource opened by {\ttfamily bt\+\_\+open}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by \hyperlink{tcp_8h_a73bbacb33eb7b06833dabe1539b6e4bd}{tcp\+\_\+open()} \\
\hline
\end{DoxyParams}


Definition at line 241 of file tcp.\+c.

\hypertarget{tcp_8c_acb5191eb921dee0820de3cb6da0ec8e1}{}\index{tcp.\+c@{tcp.\+c}!tcp\+\_\+error@{tcp\+\_\+error}}
\index{tcp\+\_\+error@{tcp\+\_\+error}!tcp.\+c@{tcp.\+c}}
\subsubsection[{tcp\+\_\+error(void $\ast$fd\+\_\+)}]{\setlength{\rightskip}{0pt plus 5cm}const wchar\+\_\+t$\ast$ tcp\+\_\+error (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fd\+\_\+}
\end{DoxyParamCaption}
)}\label{tcp_8c_acb5191eb921dee0820de3cb6da0ec8e1}


Returns an error string describing the last error occured. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by \hyperlink{tcp_8c_a73bbacb33eb7b06833dabe1539b6e4bd}{tcp\+\_\+open()} \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
message An error string 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000013}{Bug}]it\textquotesingle{}s useless. Could use {\ttfamily wprintf} and {\ttfamily strerror} \end{DoxyRefDesc}


Definition at line 256 of file tcp.\+c.

\hypertarget{tcp_8c_a73bbacb33eb7b06833dabe1539b6e4bd}{}\index{tcp.\+c@{tcp.\+c}!tcp\+\_\+open@{tcp\+\_\+open}}
\index{tcp\+\_\+open@{tcp\+\_\+open}!tcp.\+c@{tcp.\+c}}
\subsubsection[{tcp\+\_\+open(const char $\ast$serial, unsigned timeout)}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ tcp\+\_\+open (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{serial, }
\item[{unsigned}]{timeout}
\end{DoxyParamCaption}
)}\label{tcp_8c_a73bbacb33eb7b06833dabe1539b6e4bd}


connects to a ev3 device on the same subnet. 

open a bluetooth device described by device. {\ttfamily N\+U\+L\+L} leads to default action


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em serial} & I\+P-\/\+Address or Serial-\/\+Number of Ev3. {\ttfamily N\+U\+L\+L} connects to the first available \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\&fd pointer to file descriptor for use with tcp\+\_\+\{read,write,close,error\} If the serial number contains a dot, a direct T\+C\+P connection is attempted. The Ev3 broadcasts a U\+D\+P-\/packet every 5 seconds. This functions waits 7 seconds for that to happen. It then compares the broadcasted serial number with the value set should serial be non-\/{\ttfamily N\+U\+L\+L}. If serial is {\ttfamily N\+U\+L\+L} or the serial numbers match, a udp packet is sent to the source port on the ev3. Afterwards the Ev3 starts listening on the port it broadcasted. Then a G\+E\+T request is sent and the V\+M starts listening and business is as usual 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See also}
\href{http://www.monobrick.dk/guides/how-to-establish-a-wifi-connection-with-the-ev3-brick/}{\tt http\+://www.\+monobrick.\+dk/guides/how-\/to-\/establish-\/a-\/wifi-\/connection-\/with-\/the-\/ev3-\/brick/} 
\end{DoxySeeAlso}


Definition at line 84 of file tcp.\+c.



\subsection{Variable Documentation}
\hypertarget{tcp_8c_a82118920bf919568655ec9b421f5d04e}{}\index{tcp.\+c@{tcp.\+c}!tcp\+\_\+read@{tcp\+\_\+read}}
\index{tcp\+\_\+read@{tcp\+\_\+read}!tcp.\+c@{tcp.\+c}}
\subsubsection[{tcp\+\_\+read}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ tcp\+\_\+read) (void $\ast$device, {\bf u8} $\ast$buf, size\+\_\+t count, int milliseconds) = {\bf bt\+\_\+read}}\label{tcp_8c_a82118920bf919568655ec9b421f5d04e}


writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\mbox{\tt in}  & {\em buf} & buffer to write to \\
\hline
\mbox{\tt in}  & {\em count} & number of characters to be read \\
\hline
\mbox{\tt in}  & {\em milliseconds} & number of milliseconds to wait at maximum. -\/1 is indefinitely \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
status -\/1 on error. bytes read otherwise. 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000015}{Bug}]the milliseconds part needs to be tested more throughly \begin{DoxySeeAlso}{See also}
implementation at \hyperlink{bt-win_8c}{bt-\/win.\+c} and \hyperlink{bt-unix_8c}{bt-\/unix.\+c} 
\end{DoxySeeAlso}
\end{DoxyRefDesc}


Definition at line 272 of file tcp.\+c.

\hypertarget{tcp_8c_a5f7000a76dbf208a176f1b3b5ea9cebc}{}\index{tcp.\+c@{tcp.\+c}!tcp\+\_\+write@{tcp\+\_\+write}}
\index{tcp\+\_\+write@{tcp\+\_\+write}!tcp.\+c@{tcp.\+c}}
\subsubsection[{tcp\+\_\+write}]{\setlength{\rightskip}{0pt plus 5cm}int($\ast$ tcp\+\_\+write) (void $\ast$device, const {\bf u8} $\ast$buf, size\+\_\+t count) = {\bf bt\+\_\+write}}\label{tcp_8c_a5f7000a76dbf208a176f1b3b5ea9cebc}


writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\mbox{\tt in}  & {\em buf} & byte string to write, the first byte is omitted \\
\hline
\mbox{\tt in}  & {\em count} & number of characters to be written (including leading ignored byte) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
status -\/1 on error. bytes read otherwise. 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000014}{Bug}]the first byte is omitted for compatiblity with the leading report byte demanded by {\ttfamily hid\+\_\+write}. Wrapping H\+I\+D\+A\+P\+I could fix this. \begin{DoxySeeAlso}{See also}
implementation at \hyperlink{bt-win_8c}{bt-\/win.\+c} and \hyperlink{bt-unix_8c}{bt-\/unix.\+c} 
\end{DoxySeeAlso}
\end{DoxyRefDesc}


Definition at line 271 of file tcp.\+c.

