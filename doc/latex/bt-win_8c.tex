\hypertarget{bt-win_8c}{}\section{src/bt-\/win.c File Reference}
\label{bt-win_8c}\index{src/bt-\/win.\+c@{src/bt-\/win.\+c}}


Windows bluetooth I/\+O using virtual C\+O\+M port.  


{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include $<$windows.\+h$>$}\\*
{\ttfamily \#include \char`\"{}defs.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{bt-win_8c_a9ed5212b4acf61bb0f7b9b9078ba67ae}{B\+T}~\char`\"{}C\+O\+M1\char`\"{}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{bt-win_8c_a4926e3ba996c4e77d68845713a09db0c}{bt\+\_\+open} (const char $\ast$device, const char $\ast$unused)
\begin{DoxyCompactList}\small\item\em opens C\+O\+M Porte described by device. {\ttfamily N\+U\+L\+L} leads to default action \end{DoxyCompactList}\item 
int \hyperlink{bt-win_8c_a4da84bfe7c552c082e73af8f28ff2af5}{bt\+\_\+write} (void $\ast$\hyperlink{ev3__io_8h_aa0fee4a3e0cbfef079dcc441aaf8a8bf}{handle}, const \hyperlink{defs_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8} $\ast$buf, size\+\_\+t count)
\begin{DoxyCompactList}\small\item\em writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device \end{DoxyCompactList}\item 
int \hyperlink{bt-win_8c_a5861a216864bb97223f98e631f0c667c}{bt\+\_\+read} (void $\ast$\hyperlink{ev3__io_8h_aa0fee4a3e0cbfef079dcc441aaf8a8bf}{handle}, \hyperlink{defs_8h_a92c50087ca0e64fa93fc59402c55f8ca}{u8} $\ast$buf, size\+\_\+t count, int milliseconds)
\begin{DoxyCompactList}\small\item\em writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device \end{DoxyCompactList}\item 
void \hyperlink{bt-win_8c_a66111b994dc31a22f27679a286c338e4}{bt\+\_\+close} (void $\ast$\hyperlink{ev3__io_8h_aa0fee4a3e0cbfef079dcc441aaf8a8bf}{handle})
\begin{DoxyCompactList}\small\item\em calls Close\+Handle on argument \end{DoxyCompactList}\item 
const wchar\+\_\+t $\ast$ \hyperlink{bt-win_8c_a91cd0489b6e5dc0973109579ca9c7a55}{bt\+\_\+error} (void $\ast$fd\+\_\+)
\begin{DoxyCompactList}\small\item\em Returns an error string describing the last error occured. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Windows bluetooth I/\+O using virtual C\+O\+M port. 

\begin{DoxyAuthor}{Author}
Ahmad Fatoum 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
(c) 2015 Ahmad Fatoum. Code available under terms of the G\+N\+U General Public License 3.\+0 
\end{DoxyCopyright}


\subsection{Macro Definition Documentation}
\hypertarget{bt-win_8c_a9ed5212b4acf61bb0f7b9b9078ba67ae}{}\index{bt-\/win.\+c@{bt-\/win.\+c}!B\+T@{B\+T}}
\index{B\+T@{B\+T}!bt-\/win.\+c@{bt-\/win.\+c}}
\subsubsection[{B\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define B\+T~\char`\"{}C\+O\+M1\char`\"{}}\label{bt-win_8c_a9ed5212b4acf61bb0f7b9b9078ba67ae}


Definition at line 14 of file bt-\/win.\+c.



\subsection{Function Documentation}
\hypertarget{bt-win_8c_a66111b994dc31a22f27679a286c338e4}{}\index{bt-\/win.\+c@{bt-\/win.\+c}!bt\+\_\+close@{bt\+\_\+close}}
\index{bt\+\_\+close@{bt\+\_\+close}!bt-\/win.\+c@{bt-\/win.\+c}}
\subsubsection[{bt\+\_\+close(void $\ast$handle)}]{\setlength{\rightskip}{0pt plus 5cm}void bt\+\_\+close (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{handle}
\end{DoxyParamCaption}
)}\label{bt-win_8c_a66111b994dc31a22f27679a286c338e4}


calls Close\+Handle on argument 

Closes the resource opened by {\ttfamily bt\+\_\+open}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em handle} & handle returned by bt\+\_\+open \\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000006}{Bug}]It takes whopping 3 seconds for the C\+O\+M port to be reclaimable. If opened before that, the device is unusable for a minute. \end{DoxyRefDesc}


Definition at line 69 of file bt-\/win.\+c.

\hypertarget{bt-win_8c_a91cd0489b6e5dc0973109579ca9c7a55}{}\index{bt-\/win.\+c@{bt-\/win.\+c}!bt\+\_\+error@{bt\+\_\+error}}
\index{bt\+\_\+error@{bt\+\_\+error}!bt-\/win.\+c@{bt-\/win.\+c}}
\subsubsection[{bt\+\_\+error(void $\ast$fd\+\_\+)}]{\setlength{\rightskip}{0pt plus 5cm}const wchar\+\_\+t$\ast$ bt\+\_\+error (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fd\+\_\+}
\end{DoxyParamCaption}
)}\label{bt-win_8c_a91cd0489b6e5dc0973109579ca9c7a55}


Returns an error string describing the last error occured. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
message An error string 
\end{DoxyReturn}


Definition at line 79 of file bt-\/win.\+c.

\hypertarget{bt-win_8c_a4926e3ba996c4e77d68845713a09db0c}{}\index{bt-\/win.\+c@{bt-\/win.\+c}!bt\+\_\+open@{bt\+\_\+open}}
\index{bt\+\_\+open@{bt\+\_\+open}!bt-\/win.\+c@{bt-\/win.\+c}}
\subsubsection[{bt\+\_\+open(const char $\ast$device, const char $\ast$unused)}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ bt\+\_\+open (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{device, }
\item[{const char $\ast$}]{unused}
\end{DoxyParamCaption}
)}\label{bt-win_8c_a4926e3ba996c4e77d68845713a09db0c}


opens C\+O\+M Porte described by device. {\ttfamily N\+U\+L\+L} leads to default action 

open a bluetooth device described by device. {\ttfamily N\+U\+L\+L} leads to default action


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em virtual} & C\+O\+M port or N\+U\+L\+L \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
H\+A\+N\+D\+L\+E Windows H\+A\+N\+D\+L\+E to virtual C\+O\+M port for use with bt\+\_\+\{read,write,close,error\} 
\end{DoxyReturn}


Definition at line 21 of file bt-\/win.\+c.

\hypertarget{bt-win_8c_a5861a216864bb97223f98e631f0c667c}{}\index{bt-\/win.\+c@{bt-\/win.\+c}!bt\+\_\+read@{bt\+\_\+read}}
\index{bt\+\_\+read@{bt\+\_\+read}!bt-\/win.\+c@{bt-\/win.\+c}}
\subsubsection[{bt\+\_\+read(void $\ast$handle, u8 $\ast$buf, size\+\_\+t count, int milliseconds)}]{\setlength{\rightskip}{0pt plus 5cm}int bt\+\_\+read (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{handle, }
\item[{{\bf u8} $\ast$}]{buf, }
\item[{size\+\_\+t}]{count, }
\item[{int}]{milliseconds}
\end{DoxyParamCaption}
)}\label{bt-win_8c_a5861a216864bb97223f98e631f0c667c}


writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em device} & handle returned by bt\+\_\+open \\
\hline
\mbox{\tt in}  & {\em buf} & buffer to write to \\
\hline
\mbox{\tt in}  & {\em count} & number of characters to be read \\
\hline
\mbox{\tt in}  & {\em milliseconds} & is ignored \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
status -\/1 on error. bytes read otherwise. 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000005}{Bug}]milliseconds is ignored \end{DoxyRefDesc}


Definition at line 56 of file bt-\/win.\+c.

\hypertarget{bt-win_8c_a4da84bfe7c552c082e73af8f28ff2af5}{}\index{bt-\/win.\+c@{bt-\/win.\+c}!bt\+\_\+write@{bt\+\_\+write}}
\index{bt\+\_\+write@{bt\+\_\+write}!bt-\/win.\+c@{bt-\/win.\+c}}
\subsubsection[{bt\+\_\+write(void $\ast$handle, const u8 $\ast$buf, size\+\_\+t count)}]{\setlength{\rightskip}{0pt plus 5cm}int bt\+\_\+write (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{handle, }
\item[{const {\bf u8} $\ast$}]{buf, }
\item[{size\+\_\+t}]{count}
\end{DoxyParamCaption}
)}\label{bt-win_8c_a4da84bfe7c552c082e73af8f28ff2af5}


writes buf\mbox{[}1\mbox{]} till buf\mbox{[}count -\/ 2\mbox{]} to device 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em handle} & handle returned by bt\+\_\+open \\
\hline
\mbox{\tt in}  & {\em buf} & byte string to write, the first byte is omitted \\
\hline
\mbox{\tt in}  & {\em count} & number of characters to be written (including leading ignored byte) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
status -\/1 on error. bytes read otherwise. 
\end{DoxyReturn}
\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000004}{Bug}]the first byte is omitted for compatiblity with the leading report byte demanded by {\ttfamily hid\+\_\+write}. Wrapping H\+I\+D\+A\+P\+I could fix this. \end{DoxyRefDesc}


Definition at line 36 of file bt-\/win.\+c.

